import static org.junit.Assert.assertEquals;

import java.util.ArrayList;

import org.junit.jupiter.api.AfterAll;
import org.junit.jupiter.api.BeforeAll;
import org.junit.jupiter.api.Test;

public class LZWCompressionTest {
    @BeforeAll
    static void setup() throws Exception {
        Utils.deleteFile("test");
        Utils.writeStringToFile("test",
                "A robot may not injure a human being or, through inaction, allow a human being to come to harm. A robot must obey the orders given to it by human beings, except where such orders would conflict with the First Law. A robot must protect its own existence.");
    }

    @AfterAll
    static void cleanup() throws Exception {
        Utils.deleteFile("test");
    }

    @Test
    void testCompress() throws Exception {
        int[] codes = { 65, 32, 114, 111, 98, 111, 116, 32, 109, 97, 121, 32, 110, 261, 32, 105, 110, 106, 117, 114,
                101, 32, 97, 32, 104, 117, 264, 110, 32, 98, 101, 271, 103, 32, 111, 114, 44, 32, 116, 104, 258, 117,
                103, 104, 270, 110, 97, 99, 116, 105, 111, 110, 292, 97, 108, 108, 111, 119, 277, 279, 281, 97, 283,
                285, 287, 293, 111,
                32, 99, 111, 109, 276, 116, 322, 104, 97, 114, 109, 46, 32, 256, 258, 260, 262, 109, 117, 115, 262, 259,
                101, 266, 294, 276, 290, 100, 101, 114, 115, 32, 103, 105, 118, 101, 283, 328, 270, 262, 98, 266, 280,
                282, 284, 286, 110, 103, 115, 292, 101, 120, 99, 101, 112, 262, 119, 104, 351, 276, 115, 117, 99, 299,
                349,
                351, 353, 119, 111, 117, 108, 100, 323, 306, 102, 108, 105, 303, 32, 119, 105, 294, 293, 380, 32, 70,
                105, 352, 262, 76, 97, 119, 334, 336, 259, 269, 340, 342, 32, 112, 258, 116, 101, 400, 403, 353, 312,
                283, 373, 105, 342, 358, 375, 46 };
        ArrayList<Integer> codesList = new ArrayList<>();
        for (int code : codes) {
            codesList.add(code);
        }

        assertEquals("not the right codes are created", codesList, LZWCompression.compressToCodes("test"));

        ArrayList<boolean[]> bins = LZWCompression.compress("test");
        StringBuilder testBins = new StringBuilder();
        for (boolean[] bits : bins) {
            for (boolean bit : bits) {
                if (bit) {
                    testBins.append("1");
                } else {
                    testBins.append("0");
                }
            }
        }

        String expectedBins = "000001000001000000100000000001110010000001101111000001100010000001101111000001110100000000100000000001101101000001100001000001111001000000100000000001101110000100000101000000100000000001101001000001101110000001101010000001110101000001110010000001100101000000100000000001100001000000100000000001101000000001110101000100001000000001101110000000100000000001100010000001100101000100001111000001100111000000100000000001101111000001110010000000101100000000100000000001110100000001101000000100000010000001110101000001100111000001101000000100001110000001101110000001100001000001100011000001110100000001101001000001101111000001101110000100100100000001100001000001101100000001101100000001101111000001110111000100010101000100010111000100011001000001100001000100011011000100011101000100011111000100100101000001101111000000100000000001100011000001101111000001101101000100010100000001110100000101000010000001101000000001100001000001110010000001101101000000101110000000100000000100000000000100000010000100000100000100000110000001101101000001110101000001110011000100000110000100000011000001100101000100001010000100100110000100010100000100100010000001100100000001100101000001110010000001110011000000100000000001100111000001101001000001110110000001100101000100011011000101001000000100001110000100000110000001100010000100001010000100011000000100011010000100011100000100011110000001101110000001100111000001110011000100100100000001100101000001111000000001100011000001100101000001110000000100000110000001110111000001101000000101011111000100010100000001110011000001110101000001100011000100101011000101011101000101011111000101100001000001110111000001101111000001110101000001101100000001100100000101000011000100110010000001100110000001101100000001101001000100101111000000100000000001110111000001101001000100100110000100100101000101111100000000100000000001000110000001101001000101100000000100000110000001001100000001100001000001110111000101001110000101010000000100000011000100001101000101010100000101010110000000100000000001110000000100000010000001110100000001100101000110010000000110010011000101100001000100111000000100011011000101110101000001101001000101010110000101100110000101110111000000101110";

        assertEquals("not the right bins are created", testBins.toString(), expectedBins);
    }

    @Test
    void testDecode() throws Exception {
        int[] codes = { 65, 32, 114, 111, 98, 111, 116, 32, 109, 97, 121, 32, 110, 261, 32, 105, 110, 106, 117, 114,
                101, 32, 97, 32, 104, 117, 264, 110, 32, 98, 101, 271, 103, 32, 111, 114, 44, 32, 116, 104, 258, 117,
                103, 104, 270, 110, 97, 99, 116, 105, 111, 110, 292, 97, 108, 108, 111, 119, 277, 279, 281, 97, 283,
                285, 287, 293, 111,
                32, 99, 111, 109, 276, 116, 322, 104, 97, 114, 109, 46, 32, 256, 258, 260, 262, 109, 117, 115, 262, 259,
                101, 266, 294, 276, 290, 100, 101, 114, 115, 32, 103, 105, 118, 101, 283, 328, 270, 262, 98, 266, 280,
                282, 284, 286, 110, 103, 115, 292, 101, 120, 99, 101, 112, 262, 119, 104, 351, 276, 115, 117, 99, 299,
                349,
                351, 353, 119, 111, 117, 108, 100, 323, 306, 102, 108, 105, 303, 32, 119, 105, 294, 293, 380, 32, 70,
                105, 352, 262, 76, 97, 119, 334, 336, 259, 269, 340, 342, 32, 112, 258, 116, 101, 400, 403, 353, 312,
                283, 373, 105, 342, 358, 375, 46 };
        ArrayList<Integer> codesList = new ArrayList<>();
        for (int code : codes) {
            codesList.add(code);
        }
        String expected = "A robot may not injure a human being or, through inaction, allow a human being to come to harm. A robot must obey the orders given to it by human beings, except where such orders would conflict with the First Law. A robot must protect its own existence.";

        assertEquals("the correct string is not decoded", expected, LZWCompression.decodeCodes(codesList));
    }
}
